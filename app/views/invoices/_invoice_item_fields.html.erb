<div class="nested-fields">
 <div class="nested-fields">
  <div class="row">
    <div class="col-md-4 mb-3">
      <%= f.label :item, class: "form-label fw-bold" %>
      <%= f.text_field :item,  class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :quantity, class: "form-label fw-bold" %>
      <%= f.number_field :quantity, class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :service, 'Service', class: "form-label fw-bold" %>
      <%= f.collection_select :service_id, @services, :id, :name, { prompt: "Select Service" }, { class: "form-select", id: "service-select", disabled: (action_name == "show") } %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :unit_price, class: "form-label fw-bold" %>
      <%= f.number_field :unit_price, class: "form-control", id: "unit-price", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :gst, "GST (%)", class: "form-label fw-bold" %>
      <%= f.number_field :gst, class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :cgst, class: "form-label fw-bold" %>
      <%= f.number_field :cgst, class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
     <%= f.label :sgst, class: "form-label fw-bold" %>
     <%= f.number_field :sgst, class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :total, class: "form-label fw-bold" %>
      <%= f.number_field :total, class: "form-control", disabled: action_name == "show" %>
    </div>
    <div class="col">
      <%= link_to_remove_association "Remove", f, class: "btn btn-danger" %>
    </div>
  </div>
  <hr>
 </div>
</div>

<script>
 document.addEventListener("DOMContentLoaded", function () {
  const serviceSelect = document.getElementById("service-select");
  const unitPriceInput = document.getElementById("unit-price");

  const services = <%= raw(@services.to_json(only: [:id, :amount])) %>;

  serviceSelect.addEventListener("change", function () {
    const selectedId = parseInt(this.value);
    const service = services.find(s => s.id === selectedId);
    unitPriceInput.value = service ? service.amount : "";
  });
 });

</script>